<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault - Debt & Credit</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" style="float: left; text-decoration: none;">тмЕя╕П ржлрж┐рж░рзЗ ржпрж╛ржи</a>
            <h2 style="text-align: center;">ЁЯТ╕ ржжрзЗржирж╛-ржкрж╛ржУржирж╛</h2>
        </header>

        <div class="form-group">
            <label>ржмрзНржпржХрзНрждрж┐рж░ ржирж╛ржо:</label>
            <input type="text" id="personName" placeholder="ржпрзЗржоржи: рж░рж╣рж┐ржо рж╕рж╛рж╣рзЗржм">
            
            <label>ржкрж░рж┐ржорж╛ржг (рз│):</label>
            <input type="number" id="debtAmt" placeholder="0.00">
            
            <label>ржзрж░ржг:</label>
            <select id="debtType">
                <option value="get">ржЖржорж┐ ржкрж╛ржм (ржкрж╛ржУржирж╛)</option>
                <option value="give">рж╕рзЗ ржкрж╛ржмрзЗ (ржжрзЗржирж╛)</option>
            </select>
            
            <button onclick="saveDebt()" id="debtBtn">рж╕рзЗржн ржХрж░рзБржи</button>
        </div>

        <hr>
        <h3>ржжрзЗржирж╛-ржкрж╛ржУржирж╛рж░ рждрж╛рж▓рж┐ржХрж╛</h3>
        <div id="debtList">рж▓рзЛржбрж┐ржВ...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ржЖржкржирж╛рж░ рж╕ржарж┐ржХ Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyB-6yH2CTfA4bBny99kOElCypisOAJqbeo",
            authDomain: "rj-vault-14646.firebaseapp.com",
            databaseURL: "https://rj-vault-14646-default-rtdb.firebaseio.com",
            projectId: "rj-vault-14646",
            storageBucket: "rj-vault-14646.firebasestorage.app",
            messagingSenderId: "512342363505",
            appId: "1:512342363505:web:db70675bf68e6197197ad0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ржбрж╛ржЯрж╛ рж╕рзЗржн ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
        window.saveDebt = function() {
            const name = document.getElementById('personName').value;
            const amt = parseFloat(document.getElementById('debtAmt').value);
            const type = document.getElementById('debtType').value;
            const btn = document.getElementById('debtBtn');

            if(name && !isNaN(amt)) {
                btn.disabled = true;
                const debtRef = ref(db, 'debt_data');
                const newDebtRef = push(debtRef);
                
                set(newDebtRef, {
                    name: name,
                    amt: amt,
                    type: type,
                    date: new Date().toLocaleDateString('bn-BD')
                })
                .then(() => {
                    alert("рж╣рж┐рж╕рж╛ржм рж░рж╛ржЦрж╛ рж╣рзЯрзЗржЫрзЗ!");
                    document.getElementById('personName').value = '';
                    document.getElementById('debtAmt').value = '';
                    btn.disabled = false;
                })
                .catch((e) => alert("Error: " + e.message));
            } else {
                alert("рж╕ржм рждржерзНржп рж╕ржарж┐ржХржнрж╛ржмрзЗ ржжрж┐ржиред");
            }
        }

        // ржбрж╛ржЯрж╛ ржжрзЗржЦрж╛ржирзЛрж░ ржлрж╛ржВрж╢ржи
        const debtRef = ref(db, 'debt_data');
        onValue(debtRef, (snapshot) => {
            const data = snapshot.val();
            const display = document.getElementById('debtList');
            display.innerHTML = '';
            
            if (data) {
                Object.keys(data).forEach(key => {
                    const item = data[key];
                    const color = item.type === 'get' ? '#28a745' : '#dc3545';
                    const text = item.type === 'get' ? 'ржЖржорж┐ ржкрж╛ржм' : 'ржЖржорж┐ ржжрзЗржм';
                    
                    display.innerHTML += `
                        <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 5px; border-radius: 5px; position: relative;">
                            <strong>${item.name}</strong> <br>
                            <span style="color:${color}">${text}: рз│${item.amt}</span> <br>
                            <small>${item.date}</small>
                            <button onclick="deleteDebt('${key}')" style="position:absolute; right:10px; top:10px; background:none; border:none; color:red; cursor:pointer;">тЭМ</button>
                        </div>`;
                });
            } else {
                display.innerHTML = 'ржХрзЛржирзЛ ржжрзЗржирж╛-ржкрж╛ржУржирж╛ ржирзЗржЗред';
            }
        });

        // ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
        window.deleteDebt = function(key) {
            if(confirm("ржПржЗ рж╣рж┐рж╕рж╛ржмржЯрж┐ ржХрж┐ ржорзБржЫрзЗ ржлрзЗрж▓рждрзЗ ржЪрж╛ржи?")) {
                remove(ref(db, 'debt_data/' + key));
            }
        }
    </script>
</body>
</html>

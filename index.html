<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault - Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç‡ßü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .summary-cards { display: flex; gap: 10px; margin: 20px 0; }
        .card { flex: 1; padding: 20px; border-radius: 10px; text-align: center; color: white; }
        .income { background: #28a745; }
        .expense { background: #dc3545; }
        .balance { background: #007bff; }
        .nav-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; text-align: center; background: #333; color: white; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîí Vault Dashboard</h1>
        </header>

        <div class="summary-cards">
            <div class="card income">
                <h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</h3>
                <p>‡ß≥ <span id="totalIncome">0</span></p>
            </div>
            <div class="card expense">
                <h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡ßü</h3>
                <p>‡ß≥ <span id="totalExpense">0</span></p>
            </div>
            <div class="card balance">
                <h3>‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü</h3>
                <p>‡ß≥ <span id="totalBalance">0</span></p>
            </div>
        </div>

        <nav>
            <a href="ledger.html" class="nav-btn">üìù ‡¶Ü‡ßü-‡¶¨‡ßç‡¶Ø‡ßü ‡¶≤‡¶ø‡¶™‡¶ø</a>
            <a href="debt.html" class="nav-btn">üí∏ ‡¶¶‡ßá‡¶®‡¶æ-‡¶™‡¶æ‡¶ì‡¶®‡¶æ</a>
            <a href="accounts.html" class="nav-btn">üè¶ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶∏</a>
            <a href="reports.html" class="nav-btn">üìä ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</a>
        </nav>

        <button onclick="logout()" style="margin-top:20px; width:100%; cursor:pointer;">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï Firebase Config (image_8b053b.png ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶Ç‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§)
        const firebaseConfig = {
            apiKey: "AIzaSyB-6yH2CTfA4bBny99kOElCypisOAJqbeo",
            authDomain: "rj-vault-14646.firebaseapp.com",
            databaseURL: "https://rj-vault-14646-default-rtdb.firebaseio.com",
            projectId: "rj-vault-14646",
            storageBucket: "rj-vault-14646.firebasestorage.app",
            messagingSenderId: "512342363505",
            appId: "1:512342363505:web:db70675bf68e6197197ad0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ‡¶≤‡¶ó‡¶á‡¶® ‡¶ó‡¶æ‡¶∞‡ßç‡¶° (sessionStorage)
        if (sessionStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }

        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶®
        const ledgerRef = ref(db, 'ledger_data');
        onValue(ledgerRef, (snapshot) => {
            let income = 0;
            let expense = 0;
            const data = snapshot.val();
            
            if (data) {
                Object.values(data).forEach(item => {
                    let amount = parseFloat(item.amt || 0);
                    if (item.cat === 'income') {
                        income += amount;
                    } else {
                        expense += amount;
                    }
                });
            }

            document.getElementById('totalIncome').innerText = income;
            document.getElementById('totalExpense').innerText = expense;
            document.getElementById('totalBalance').innerText = (income - expense);
        });

        window.logout = function() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault - Ledger</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" style="float: left; text-decoration: none;">‚¨ÖÔ∏è ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</a>
            <h2 style="text-align: center;">üìù ‡¶Ü‡ßü-‡¶¨‡ßç‡¶Ø‡ßü ‡¶≤‡¶ø‡¶™‡¶ø</h2>
        </header>

        <div class="form-group">
            <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</label>
            <input type="text" id="desc" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡ßá‡¶§‡¶®, ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞ ‡¶ñ‡¶∞‡¶ö">
            
            <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥):</label>
            <input type="number" id="amt" placeholder="0.00">
            
            <label>‡¶ß‡¶∞‡¶£:</label>
            <select id="cat">
                <option value="income">‡¶Ü‡ßü (+)</option>
                <option value="expense">‡¶¨‡ßç‡¶Ø‡ßü (-)</option>
            </select>
            
            <button onclick="saveData()" id="saveBtn">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <hr>
        <h3>‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
        <div id="recentEntries">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, limitToLast, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyB-6yH2CTfA4bBny99kOElCypisOAJqbeo",
            authDomain: "rj-vault-14646.firebaseapp.com",
            databaseURL: "https://rj-vault-14646-default-rtdb.firebaseio.com",
            projectId: "rj-vault-14646",
            storageBucket: "rj-vault-14646.firebasestorage.app",
            messagingSenderId: "512342363505",
            appId: "1:512342363505:web:db70675bf68e6197197ad0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.saveData = function() {
            const desc = document.getElementById('desc').value;
            const amt = parseFloat(document.getElementById('amt').value);
            const cat = document.getElementById('cat').value;
            const saveBtn = document.getElementById('saveBtn');

            if(desc && !isNaN(amt)) {
                saveBtn.disabled = true;
                saveBtn.innerText = "‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

                const listRef = ref(db, 'ledger_data');
                const newEntryRef = push(listRef);
                
                set(newEntryRef, {
                    desc: desc,
                    amt: amt,
                    cat: cat,
                    date: new Date().toLocaleString('bn-BD')
                })
                .then(() => {
                    alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                    document.getElementById('desc').value = '';
                    document.getElementById('amt').value = '';
                    saveBtn.disabled = false;
                    saveBtn.innerText = "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®";
                })
                .catch((error) => {
                    alert("‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + error.message);
                    saveBtn.disabled = false;
                });
            } else {
                alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®‡•§");
            }
        }

        // ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡ß´‡¶ü‡¶ø ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
        const recentRef = query(ref(db, 'ledger_data'), limitToLast(5));
        onValue(recentRef, (snapshot) => {
            const data = snapshot.val();
            const display = document.getElementById('recentEntries');
            display.innerHTML = '';
            
            if (data) {
                Object.values(data).reverse().forEach(item => {
                    const color = item.cat === 'income' ? 'green' : 'red';
                    display.innerHTML += `<p style="border-bottom:1px solid #ddd; padding:5px;">
                        <strong>${item.desc}</strong>: <span style="color:${color}">‡ß≥${item.amt}</span> <br>
                        <small>${item.date}</small>
                    </p>`;
                });
            } else {
                display.innerHTML = '‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á‡•§';
            }
        });
    </script>
</body>
</html>

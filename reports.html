<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault - Reports</title>
    <link rel="stylesheet" href="style.css">
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f4f4f4; }
        .inc-row { color: #28a745; font-weight: bold; }
        .exp-row { color: #dc3545; font-weight: bold; }
        .del-btn { color: red; cursor: pointer; border: none; background: none; font-size: 1.1em; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" style="float: left; text-decoration: none;">‚¨ÖÔ∏è ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</a>
            <h2 style="text-align: center;">üìä ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
        </header>

        <div class="report-summary" style="padding: 10px; background: #eee; border-radius: 5px; margin-bottom: 10px;">
            <p>‡¶Æ‡ßã‡¶ü ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ: <span id="entryCount">0</span></p>
        </div>

        <table>
            <thead>
                <tr>
                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                    <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                    <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                    <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                </tr>
            </thead>
            <tbody id="reportTableBody">
                </tbody>
        </table>
        <div id="noData" style="text-align:center; padding:20px; display:none;">‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyB-6yH2CTfA4bBny99kOElCypisOAJqbeo",
            authDomain: "rj-vault-14646.firebaseapp.com",
            databaseURL: "https://rj-vault-14646-default-rtdb.firebaseio.com",
            projectId: "rj-vault-14646",
            storageBucket: "rj-vault-14646.firebasestorage.app",
            messagingSenderId: "512342363505",
            appId: "1:512342363505:web:db70675bf68e6197197ad0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        const ledgerRef = ref(db, 'ledger_data');
        onValue(ledgerRef, (snapshot) => {
            const data = snapshot.val();
            const tableBody = document.getElementById('reportTableBody');
            const noData = document.getElementById('noData');
            const entryCount = document.getElementById('entryCount');
            
            tableBody.innerHTML = '';
            
            if (data) {
                noData.style.display = 'none';
                const keys = Object.keys(data).reverse(); // ‡¶®‡¶§‡ßÅ‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶ó‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                entryCount.innerText = keys.length;

                keys.forEach(key => {
                    const item = data[key];
                    const rowClass = item.cat === 'income' ? 'inc-row' : 'exp-row';
                    const prefix = item.cat === 'income' ? '+' : '-';
                    
                    const row = `<tr>
                        <td><small>${item.date || 'N/A'}</small></td>
                        <td>${item.desc}</td>
                        <td class="${rowClass}">${prefix} ‡ß≥${item.amt}</td>
                        <td><button class="del-btn" onclick="deleteEntry('${key}')">üóëÔ∏è</button></td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });
            } else {
                noData.style.display = 'block';
                entryCount.innerText = '0';
            }
        });

        // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.deleteEntry = function(key) {
            if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                remove(ref(db, 'ledger_data/' + key))
                .then(() => alert("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!"))
                .catch((e) => alert("Error: " + e.message));
            }
        }
    </script>
</body>
</html>
